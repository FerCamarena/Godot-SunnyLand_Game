[gd_scene load_steps=3 format=3 uid="uid://bdhg2jk7wxbv4"]

[ext_resource type="Texture2D" uid="uid://c2quooqnbmx40" path="res://Sprites/Tilesets/decorations_tilesheet.png" id="1_b5h4y"]

[sub_resource type="GDScript" id="GDScript_bq2oj"]
resource_name = "DynamicTouchInteractions"
script/source = "#Libraries
extends Area2D

#Registration
class_name DynamicTouchInteractions

#Atributes
var rotationOffset: float = 0.0

#Components
@export var sprite: Sprite2D

#Method called once at start
func _ready():
	$Sprite.flip_h = randi() % 2 == 0

#Method called on frame time updates
func _process(_delta):
	#Rotating based on collision movements
	set_rotation(rotate_toward(rotation, rotationOffset, 5 * _delta))

#Method called once every body-entering signal
func _on_body_entered(body: Node):
	#Detection for character collision
	if body is CharacterBody2D:
		rotationOffset = body.velocity.x / 500
		#await get_tree().create_timer(0.1).timeout
		#if body.position.x < position.x:
			#rotationOffset *= -1

#Method called once every body-exiting signal
func _on_body_exited(body: Node2D) -> void:
	#Detection for character collision
	if body is CharacterBody2D:
		if rotationOffset != 0.0:
			await get_tree().create_timer(0.1).timeout
			rotationOffset = 0.0
"

[node name="BaseTouchable" type="Area2D"]
position = Vector2(0, -9)
collision_layer = 32
monitorable = false
script = SubResource("GDScript_bq2oj")

[node name="Sprite" type="Sprite2D" parent="."]
position = Vector2(0, 18)
texture = ExtResource("1_b5h4y")
centered = false
offset = Vector2(-9, -18)
hframes = 22
vframes = 9
frame = 88

[node name="Shape" type="CollisionShape2D" parent="."]

[connection signal="body_entered" from="." to="." method="_on_body_entered"]
[connection signal="body_exited" from="." to="." method="_on_body_exited"]
